<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="bootstrap-5.0.2-dist/css/bootstrap.min.css" rel="stylesheet">
<link href="web.css" rel="stylesheet">
<link href="fontawesome/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>
	<script src="jquery-3.5.1.min.js"></script>
	<script src="bootstrap-5.0.2-dist/js/bootstrap.bundle.min.js"></script>
	<script src="web.js"></script>
	<div>
		<div id="connections" class="container-fluid">
			<div id="connectionTemplate" class="row connection pt-3 pb-3"
				data-bs-toggle="dropdown">
                <div class="dropdown">
                    <a class="btn btn-secondary dropdown-toggle visually-hidden" href="#" role="button"
                        id="dropdownMenuLink" data-bs-toggle="dropdown"
                        aria-expanded="false"> Dropdown link </a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        <li><a class="dropdown-item" href="#">Delete</a></li>
                        <li><a class="dropdown-item" href="#">Edit</a></li>
                        <li><a class="dropdown-item" href="#">Make Favourite</a></li>
                    </ul>
                </div>
				<div class="status-icon col-2"></div>
				<div class="col-8">
					<strong> <small class="connection-name">Connection
							Name</small>
					</strong><br /> <small class="status"></small><br /> <small
						class="subText"></small>
				</div>
				<div class="col-2">
					<div class="form-check form-switch">
						<input class="connected form-check-input" type="checkbox" />
					</div>
				</div>
			</div>
		</div>
	</div>
	<footer class="fixed-bottom m-3">
		<div class="container">
			<div class="row">
				<div class="col-6 pt-2">
					<a href="options.html"><i class="fa fa-cogs"></i><span
						data-i18n="options">Options</span></a>
				</div>
				<div class="col-6 text-end">
					<a href="addLogonBoxVPN.html" class="align-middle"><i
						class="fa fa-plus-circle fa-3x"></i></a>
				</div>
			</div>
		</div>
	</footer>


	<script type="text/javascript">
		function rebuildConnections() {
			$('.row').off('mouseenter');
			$('.row').off('mouseleave');
			$('.row').off('click');
			try {
				var connections = bridge.getConnections();
				var template = $('#connectionTemplate');
				var connectionsEl = $('#connections');
				connectionsEl.empty();
				template.appendTo(connectionsEl);
				for (var i = 0; i < connections.length; i++) {
					var connection = connections[i];
					var connectionEl = template.clone();
					connectionEl.attr('data-connection', connection.getId());
					var nameEl = connectionEl.find('.connection-name')[0];
					/* Name */
					$(nameEl).html(connection.getDisplayName());

					/* Icon */
					var connected = false;
					var iconName = 'fa-exclamation-triangle text-error';
					var statusName = connection.getStatus();
					var textStyle = '';
					var subText = '';
					if (statusName === 'DISCONNECTING') {
						iconName = 'fa-spinner fa-spin';
					} else if (statusName === 'DISCONNECTED') {
						iconName = 'fa-exclamation-triangle';
						textStyle = 'text-danger';
						subText = connection.getLastError();
					} else if (statusName === 'TEMPORARILY_OFFLINE') {
						iconName = 'fa-exclamation-triangle';
						connected = true;
						textStyle = 'text-warning';
					} else if (statusName === 'AUTHORIZING') {
						iconName = 'fa-spinner fa-spin';
						connected = true;
						textStyle = 'text-info';
					} else if (statusName === 'CONNECTING') {
						iconName = 'fa-spinner fa-spin';
						connected = true;
						textStyle = 'text-info';
					} else if (statusName === 'CONNECTED') {
						iconName = 'fa-check-circle';
						connected = true;
						textStyle = 'text-success';
					}
					var iconEl = $('<i class="fa ' + iconName + ' ' + textStyle + ' fa-3x"></i>');
					iconEl.appendTo(connectionEl.find('.status-icon')[0]);

					/* Connected switch */
					var cbEl = $(connectionEl.find('.connected')[0]);
					cbEl.prop('checked', connected);
					cbEl.change(function() {
						if (this.checked) {
							bridge.connectTo(connection);
							rebuildConnections();
						} else {
							bridge.disconnectFrom(connection);
							rebuildConnections();
						}
					});

					/* Status text */
					var statusEl = $(connectionEl.find('.status')[0]);
					statusEl.addClass(textStyle);
					statusEl.html(pageBundle.getString('status.' + connection.getStatus()));

					/* Sub text */
					var subTextEl = $(connectionEl.find('.subText')[0]);
					if (subText.length > 0) {
						subTextEl.addClass(textStyle);
						subTextEl.html(subText);
					}

					/* Right Click Actions */
					
                    var dropDownEl = $(connectionEl.find('.dropdown-toggle')[0]);
					var dropDownId = dropDownEl.attr('id') + i;
					dropDownEl.attr('id', dropDownId);
                    var dropDownMenuEl = $(connectionEl.find('.dropdown-meun')[0]);
                    dropDownMenuEl.attr('aria-labelledby', dropDownId);
					connectionEl.on('mousedown', function(evt) {
						try {
							if (evt.which === 3) {
						       /*  var posX = $(this).offset().left,
						        var posY = $(this).offset().top; */
								var bs = new bootstrap.Dropdown(dropDownEl, {
									offset: [0,0]
								});
								bs.show();
							}
						} catch (e) {
							alert(e);
						}
					});

					//
					connectionEl.appendTo(connectionsEl);
				}
			} catch (e) {
				alert(e);
			}
			template.hide();
			$('.row').on('mouseenter', function() {
				$(this).addClass('active');
			});
			$('.row').on('mouseleave', function() {
				$(this).removeClass('active');
			});
			$('.row').off('dblclick').on('dblclick', function(evt) {
				bridge.details(parseInt($(this).attr('data-connection')));
				evt.preventDefault();
			});
		}

		function uiReady() {
			rebuildConnections();
		};
	</script>
</body>
</html>
